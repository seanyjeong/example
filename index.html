<!DOCTYPE html>
<html>
<head>
    <title>University Record Input</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>University Record Input</h1>
    <form id="recordForm">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>University</th>
                    <th>제멀 (cm)</th>
                    <th>Gender</th>
                    <th>메던 (m)</th>
                    <th>Gender</th>
                    <th>10m (seconds)</th>
                    <th>Gender</th>
                    <th>배근력 (kg)</th>
                    <th>Gender</th>
                    <th>Total Score</th>
                </tr>
            </thead>
            <tbody id="studentsContainer">
                <tr class="student">
                    <td><input type="text" name="studentName" required></td>
                    <td>
                        <select name="university" required>
                            <option value="가천체육">가천체육</option>
                            <!-- 추가할 대학들 -->
                        </select>
                    </td>
                    <td><input type="number" name="recordJemul" step="0.01" required></td>
                    <td>
                        <select name="genderJemul" required>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </td>
                    <td><input type="number" name="recordMedun" step="0.01" required></td>
                    <td>
                        <select name="genderMedun" required>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </td>
                    <td><input type="number" name="record10m" step="0.01" required></td>
                    <td>
                        <select name="gender10m" required>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </td>
                    <td><input type="number" name="recordBackStrength" step="0.01" required></td>
                    <td>
                        <select name="genderBackStrength" required>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </td>
                    <td class="totalScore"></td>
                </tr>
            </tbody>
        </table>
        <button type="button" id="addStudentButton">Add Student</button>
        <button type="submit">Calculate Total Scores</button>
    </form>
    <button id="saveButton">Save All Scores</button>

    <script>
        document.getElementById('addStudentButton').addEventListener('click', function() {
            const studentsContainer = document.getElementById('studentsContainer');
            const newRow = studentsContainer.rows[0].cloneNode(true);
            newRow.querySelectorAll('input').forEach(input => input.value = '');
            newRow.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
            newRow.querySelector('.totalScore').innerText = '';
            studentsContainer.appendChild(newRow);
        });

        document.getElementById('recordForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const students = [];
            const rows = document.querySelectorAll('.student');
            rows.forEach(row => {
                const studentName = row.querySelector('input[name="studentName"]').value;
                const university = row.querySelector('select[name="university"]').value;
                const recordJemul = row.querySelector('input[name="recordJemul"]').value;
                const genderJemul = row.querySelector('select[name="genderJemul"]').value;
                const recordMedun = row.querySelector('input[name="recordMedun"]').value;
                const genderMedun = row.querySelector('select[name="genderMedun"]').value;
                const record10m = row.querySelector('input[name="record10m"]').value;
                const gender10m = row.querySelector('select[name="gender10m"]').value;
                const recordBackStrength = row.querySelector('input[name="recordBackStrength"]').value;
                const genderBackStrength = row.querySelector('select[name="genderBackStrength"]').value;

                students.push(
                    { name: studentName, university: university, event: '제멀', record: recordJemul, gender: genderJemul },
                    { name: studentName, university: university, event: '메던', record: recordMedun, gender: genderMedun },
                    { name: studentName, university: university, event: '10m', record: record10m, gender: gender10m },
                    { name: studentName, university: university, event: '배근력', record: recordBackStrength, gender: genderBackStrength }
                );
            });

            fetch('https://supermax.kr:4000/get-total-score', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ students: students })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.querySelectorAll('.totalScore').forEach((td, index) => {
                        td.innerText = 'Error';
                    });
                } else {
                    document.querySelectorAll('.student').forEach((row, index) => {
                        const totalScore = data[index].totalScore;
                        row.querySelector('.totalScore').innerText = totalScore;
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        document.getElementById('saveButton').addEventListener('click', function() {
            const students = [];
            const rows = document.querySelectorAll('.student');
            rows.forEach(row => {
                const studentName = row.querySelector('input[name="studentName"]').value;
                const university = row.querySelector('select[name="university"]').value;
                const recordJemul = row.querySelector('input[name="recordJemul"]').value;
                const genderJemul = row.querySelector('select[name="genderJemul"]').value;
                const recordMedun = row.querySelector('input[name="recordMedun"]').value;
                const genderMedun = row.querySelector('select[name="genderMedun"]').value;
                const record10m = row.querySelector('input[name="record10m"]').value;
                const gender10m = row.querySelector('select[name="gender10m"]').value;
                const recordBackStrength = row.querySelector('input[name="recordBackStrength"]').value;
                const genderBackStrength = row.querySelector('select[name="genderBackStrength"]').value;

                students.push(
                    { name: studentName, university: university, event: '제멀', record: recordJemul, gender: genderJemul },
                    { name: studentName, university: university, event: '메던', record: recordMedun, gender: genderMedun },
                    { name: studentName, university: university, event: '10m', record: record10m, gender: gender10m },
                    { name: studentName, university: university, event: '배근력', record: recordBackStrength, gender: genderBackStrength }
                );
            });

            fetch('https://supermax.kr:4000/save-scores', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ students: students })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(`Error: ${data.error}`);
                } else {
                    alert('All scores saved successfully');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>
